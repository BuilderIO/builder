import { expect } from '@playwright/test';
import { test } from '../helpers/index.js';

test.describe.only('XSS Exploit', () => {
  test('attempts XSS exploit through postMessage', async ({ page, context }) => {
    // Create a promise that will resolve when a new page is created
    const newPagePromise = context.waitForEvent('page');

    // Navigate to the exploit page
    await page.goto('/xss-exploit');

    // Wait for the new page to open
    const newPage = await newPagePromise;
    await newPage.waitForLoadState();

    // Listen for dialog events (alerts) on the new page
    let dialogShown = false;
    newPage.on('dialog', async dialog => {
      dialogShown = true;
      await dialog.dismiss();
    });

    // Wait enough time for the setTimeout to trigger (3000ms + buffer)
    await newPage.waitForTimeout(3500);

    // Verify no alert was shown
    expect(dialogShown).toBe(false);

    // Clean up by closing the new page
    await newPage.close();
  });
});
