# Monorepo

The gen2 SDKs, along with gen1 React SDK, are part of the same monorepo. The monorepo is configured using yarn v3 workspaces and [Nx](https://nx.app/).

The root of the yarn monorepo is `packages/package.json` and called `@builder.io/mono-repo`. It is made up of the following:

- `package/sdks`: the gen2 SDKs, along with all of their integration tests
- `packages/react`: the gen1 React SDK
- `packages/core`: the gen1 core SDK, used by gen1 React SDK.
- `packages/react-tests`: the gen1 React SDK integration tests
- `packages/sdks-tests`: the integration test specs & playwright configuration for both gen1 and gen2 SDKs.

**NOTE:** Even though the monorepo root is at `packages/*`, not every sub-folder is part of the monorepo. Only the ones listed above are.

## Nx

Nx is a tool that handles the complexity of building your monorepo when there are a ton of inter-dependencies. By calling `yarn nx build` (instead of `yarn build`), Nx will run all pre-requisite steps so that your `build` command is up-to-date. This vastly simplifies local development & testing.

It will also cache the results of each step, so that if you run `yarn nx build` again, it will only run the steps that have changed.

# Gen2 SDKs

## Architecture

- `package/sdks/src`: the source code for the gen2 SDKs, written in Mitosis.
- `package/sdks/output`: the source code for each of the gen2 SDKs, generated by Mitosis.
- `package/sdks/e2e`: the servers that run integration tests for each of the gen2 SDKs.

## Build process

Here is the overall picture of the gen2 SDKs build process:

- Because gen2 SDKs depend on Mitosis, which has a dependency on the gen1 React SDK, we actually need to build the `@builder.io/sdk` (core) & `@builder.io/react` (react gen1) first before we can run the mitosis build.
- We then run the mitosis build, which generates the gen2 SDKs source code in each of the `package/sdks/output` folders.
- Each individual gen2 SDK is then built using its own build tooling (some use Vite/Rollup, other require more specialized libraries specific to the intended framework).
- Finally, the integration tests are built and run. Those depend on the SDKs being built first, and also the integration tests (which live under `package/sdks-tests`).

You can visualize all of these relationships by using the Nx graph feature: run `yarn nx graph` anywhere in the mono-repo to launch the graph viewer.

## SDKs multi bundles

Because certain SDK code is environment-specific, we need to generate 3 bundles for each SDK: for the browser, NodeJS and edge runtimes. This is why each SDK is built 3 times (once for each environment). Typically, the generated output will live in `lib/edge`, `lib/node` and `lib/browser` inside of each `outputs` SDK folder.

## Mitosis

TBD: talk about:

- overrides
- mitosis.config.js
